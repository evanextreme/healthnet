{% extends "basic.html" %}
{% load fullcalendar_tags %}
{% load material_form %}


{% block body %}
    {% if user.is_authenticated %}
    <br>
    <div id="main-container" class="">
        <div id="apt-modal" class="modal modal-fixed-footer">

          <form action='.' method='post' enctype="multipart/form-data">
              <div id="apt-div">
              </div>
        </div>
        <div class="row">
        <div class="col s9">
        {% calendar %}
        </div>
        <div class="col s3">
          {% if permissions == 'patient' %}

          {% if prescriptions %}

              <ul class="collection with-header">
                  <li class="collection-header"><p>Prescriptions</p></li>
                      {% for prescription in prescriptions %}
                          <li class="collection-item">
                              <div>
                                  {{prescription}}

                              </div>
                          </li>
                      {% endfor %}
              </ul>

          {% else %}
              <p>You currently do not have any prescribed medications.</p>

          {% endif %}

          {% elif permissions == 'doctor' %}
                  <ul class="collapsible" data-collapsible="accordion">


              {% for patient in patients %}
              <li>
                <div class="collapsible-header">{{patient.user.first_name}} {{patient.user.last_name}}</div>
                <div class="collapsible-body">{{patient.card}}
                  <form action='/patients/update' method='post' enctype="multipart/form-data">
                    {% csrf_token %}
                  <button class="modal-action modal-close waves-effect waves-light btn light-blue accent-3" type="submit" name="get_patient_id" value="{{patient.patient_id}}">Update</button>
                  <button class="modal-action modal-close waves-effect waves-light btn light-blue accent-3" type="submit" name="get_patient_prescriptions" value="{{patient.patient_id}}">View/Edit Medications</button>

                </div>
              </li>


              {% endfor %}
              </ul>
          {% endif %}
        </div>
      </div>

        <div class="fixed-action-btn horizontal">
          {% if permissions == 'doctor' %}
           <a id="menu" class="btn-floating btn-large red">
           <i class="large material-icons">mode_edit</i>
           {% else %}
           <a id="menu" class="btn-floating btn-large red" onclick="newAppointment()">
           {% endif %}
           <i class="large material-icons">library_add</i>
         </a>
         <ul>
           {% if permissions == 'doctor' %}
           <li><a class="btn-floating red" onclick="newAppointment()"><i class="material-icons">library_add</i></a></li>
           <li><a class="btn-floating green" onclick="newPrescription()"><i class="material-icons">playlist_add</i></a></li>
           {% endif %}
         </ul>

        </div>

    </div>
    {% else %}
    <div id="index-banner" class="parallax-container">
  				<br><br>
  				<h1 class="header center">Your Lifeline</h1>
  				<div class="row center">
  					<h5 class="header col s12 light">We take the middleman out of medicine.</h5>
  				</div>
  		<div class="parallax img"><img src="/media/img/main.png"></div>
  	</div>

  	<div class="container">
  		<div class="section">
  			<div class="row">
  				<div class="col s12 m4">
  					<div class="icon-block">
  						<h2 class="center blue-text"><i class="mdi-hardware-desktop-windows"></i></h2>
  						<h5 class="center">Fast and light</h5>

  						<p class="light">Tomorrow is built using the latest in web and mobile technology. Tomorrow looks and works the same on every device you own, from your phone to your desktop. Tomorrow is available wherever you are, to help you get whatever you need done.</p>
  					</div>
  				</div>

  				<div class="col s12 m4">
  					<div class="icon-block">
  						<h2 class="center blue-text"><i class="mdi-social-people"></i></h2>
  						<h5 class="center">Built for humans</h5>

  						<p class="light">No one wants to use a planer that is deigned for robots. So why do we insist on doing so? Tomorrow elminates stress by only letting you plan tasks for Tomorrow. Soon Tomorrow will include automatic reminders throughout the day so that you don't need to plan your life around tasks, but so that you can plan tasks around your life.</p>
  					</div>
  				</div>

  				<div class="col s12 m4">
  					<div class="icon-block">
  						<h2 class="center blue-text"><i class="mdi-action-settings"></i></h2>
  						<h5 class="center">Productivity focused</h5>

  						<p class="light">Tomorrow is designed to make sure you get everything that you need to do out of the way, so you can live your life. We have built the app to place your productivity first and foremost, and signifigantly increases productivity when used versus similar applications.</p>
  					</div>
  				</div>
  			</div>
  		</div>
  	</div>
    {% endif %}

<style>
.parallax-container {
      width: 100%;
    }
    .fc-today {
      opacity: 0;
      border: none;
    }

    /* Styling for each event from Schedule */
    .fc-time-grid-event.fc-v-event.fc-event {
      border-radius: 4px;
      border: none;
      padding: 5px;
      opacity: .65;
      left: 5% !important;
      right: 5% !important;
    }

    /* Bolds the name of the event and inherits the font size */
    .fc-event {
      font-size: inherit !important;
      font-weight: bold !important;
    }

    /* Remove the header border from Schedule */
    .fc td, .fc th {
      border-style: none !important;
      border-width: 1px !important;
      padding: 0 !important;
      vertical-align: top !important;
    }

    /* Inherits background for each event from Schedule. */
    .fc-event .fc-bg {
      z-index: 1 !important;
      background: inherit !important;
      opacity: .25 !important;
    }

    /* Normal font weight for the time in each event */
    .fc-time-grid-event .fc-time {
      font-weight: normal !important;
    }

    /* Apply same opacity to all day events */
    .fc-ltr .fc-h-event.fc-not-end, .fc-rtl .fc-h-event.fc-not-start {
      opacity: .65 !important;
      margin-left: 12px !important;
      padding: 5px! important;
    }

    /* Apply same opacity to all day events */
    .fc-day-grid-event.fc-h-event.fc-event.fc-not-start.fc-end {
      opacity: .65 !important;
      margin-left: 12px !important;
      padding: 5px! important;
    }
</style>

<script type="text/javascript">
$(document).ready(function(){
      $('.modal').modal();
      $('.parallax').parallax();
});
function newAppointment(){
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
            // Only send the token to relative URLs i.e. locally.
              xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
        }
    }
  });
  $.get("/appointments/new/",function(response){
      $('#apt-div').html(response);
  });
  $('#apt-modal').modal('open');
}

function newPrescription(){
  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
            // Only send the token to relative URLs i.e. locally.
              xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
        }
    }
  });
  $.get("/prescriptions/new/",function(response){
      $('#apt-div').html(response);
  });
  $('#apt-modal').modal('open');
}


(function( $ ){
   $.fn.healthToast = function(text) {
      alert('TEST BOY')
      Materialize.toast('I am a toast!', 3000, 'rounded')
      alert('hello world');
      return this;
   };
})( jQuery );

function closeModal(){
  $('#apt-modal').modal('close');
}
</script>
{% endblock %}
